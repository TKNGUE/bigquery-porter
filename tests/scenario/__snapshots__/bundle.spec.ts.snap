// Vitest Snapshot v1

exports[`CLI: bundle > bundle --help 1`] = `
[
  "Usage: program bundle [options] [projects...]

Bundle SQLs into single execuatale BigQuery Script

Options:
  -h, --help  display help for command
",
]
`;

exports[`CLI: bundle > bundle --help 2`] = `[]`;

exports[`CLI: bundle > bundle -C ./examples --enable-datalineage 1`] = `
[
  "begin
-- BQPORTER: takegue.sandbox from examples/@default/sandbox/ddl.sql
CREATE SCHEMA IF NOT EXISTS \`sandbox\`
OPTIONS(
  description=\\"<!--- BQMAKE_DATASET: BEGIN -->\\\\n\`\`\`mermaid\\\\ngraph LR\\\\nsubgraph project-id-7288898082930342315.sandbox\\\\n\\\\tH1NS(sample_clone_table)\\\\n\\\\t5BLN(sample_table)\\\\n\\\\toEk9(sample_materialized_view)\\\\n\\\\tmxt6(sample_lineage)\\\\n\\\\t1Tdy(sample_partition_table)\\\\n\\\\tP5GH(sample_sharding_*)\\\\n\\\\tFHJh(sample_snapshot_table)\\\\n\\\\tsldk(stations_scd_type2)\\\\nend\\\\nsubgraph bigquery-public-data.austin_bikeshare\\\\n\\\\t0Q1b(bikeshare_stations)\\\\nend\\\\n5BLN --> H1NS\\\\noEk9 --> H1NS\\\\n5BLN --> oEk9\\\\n5BLN --> FHJh\\\\noEk9 --> FHJh\\\\n0Q1b --> sldk\\\\n\`\`\`\\\\n<!--- BQMAKE_DATASET: END -->\\",
  location=\\"us\\"
)
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.mymodel from examples/@default/sandbox/@models/mymodel/ddl.sql
CREATE MODEL IF NOT EXISTS \`sandbox.mymodel\`
OPTIONS
  ( MODEL_TYPE='LINEAR_REG',
    LS_INIT_LEARN_RATE=0.15,
    L1_REG=1,
    MAX_ITERATIONS=5 ) AS
SELECT
  c1 as column1,
  c1 * 2 as column2,
  c1 * 3 as column3,
  c1 * 10 as label
FROM
  unnest(generate_array(1, 10)) c1

exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_function from examples/@default/sandbox/@routines/sample_function/ddl.sql
CREATE OR REPLACE FUNCTION \`sandbox.sample_function\`(argument INT64) RETURNS INT64
OPTIONS(
  description=\\"test\\")
AS (
1
)
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_procedure from examples/@default/sandbox/@routines/sample_procedure/ddl.sql
CREATE OR REPLACE PROCEDURE \`sandbox.sample_procedure\`(IN sample_argument INT64)
begin 
  select 1 as a;
end
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_tvf from examples/@default/sandbox/@routines/sample_tvf/ddl.sql
CREATE OR REPLACE TABLE FUNCTION \`sandbox.sample_tvf\`(argument INT64) RETURNS TABLE<a INT64>
AS
select argument as a
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.error_sample from examples/@default/sandbox/error_sample/ddl.sql

exception when error then
end

begin
-- BQPORTER: takegue.sandbox.error_sample from examples/@default/sandbox/error_sample/test.sql

select error('error message')
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.error_sample from examples/@default/sandbox/error_sample/view.sql

hoge

exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_clone_table from examples/@default/sandbox/sample_clone_table/ddl.sql
CREATE TABLE IF NOT EXISTS \`sandbox.sample_clone_table\`
(
  a INT64
)
CLUSTER BY a
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_partition_table from examples/@default/sandbox/sample_partition_table/ddl.sql
CREATE TABLE IF NOT EXISTS \`sandbox.sample_partition_table\`
(
  date_jst DATE
)
PARTITION BY date_jst
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_sharding_* from examples/@default/sandbox/sample_sharding_@/ddl.sql
CREATE TABLE IF NOT EXISTS \`takegue.sandbox.sample_sharding_20220101\`
(
  date_jst DATE
)
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_snapshot_table from examples/@default/sandbox/sample_snapshot_table/ddl.sql
CREATE SNAPSHOT TABLE \`sandbox.sample_snapshot_table\`
CLONE \`takegue.sandbox.sample_table\`
FOR SYSTEM_TIME AS OF TIMESTAMP \\"2023-01-01T01:12:07.322Z\\"
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_table from examples/@default/sandbox/sample_table/ddl.sql
CREATE TABLE IF NOT EXISTS \`sandbox.sample_table\`
(
  a INT64 OPTIONS(description=\\"ふがふが
ふが\\")
)
CLUSTER BY a
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_view from examples/@default/sandbox/sample_view/view.sql
SELECT * FROM \`bigquery-public-data.austin_311.311_service_requests\` LIMIT 1000

exception when error then
end

begin
-- BQPORTER: takegue.sandbox from examples/@default/sandbox/@_queries/preview.sql
select * from \`sandbox.sample_table\`

exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_materialized_view from examples/@default/sandbox/sample_materialized_view/ddl.sql
CREATE MATERIALIZED VIEW IF NOT EXISTS  \`sandbox.sample_materialized_view\`
AS select 1 as a from \`sandbox.sample_table\`
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_table from examples/@default/sandbox/sample_table/preview.sql
select * from \`sandbox.sample_table\`

exception when error then
end",
]
`;

exports[`CLI: bundle > bundle -C ./examples --enable-datalineage 2`] = `
[
  "Warning: Irrelevant SQL file located in examples/@default/sandbox/error_sample/ddl.sql for takegue.sandbox.error_sample",
  "Warning: Irrelevant SQL file located in examples/@default/sandbox/error_sample/test.sql for takegue.sandbox.error_sample",
]
`;

exports[`CLI: bundle > bundle -C ./examples 1`] = `
[
  "begin
-- BQPORTER: takegue.sandbox from examples/@default/sandbox/ddl.sql
CREATE SCHEMA IF NOT EXISTS \`sandbox\`
OPTIONS(
  description=\\"<!--- BQMAKE_DATASET: BEGIN -->\\\\n\`\`\`mermaid\\\\ngraph LR\\\\nsubgraph project-id-7288898082930342315.sandbox\\\\n\\\\tH1NS(sample_clone_table)\\\\n\\\\t5BLN(sample_table)\\\\n\\\\toEk9(sample_materialized_view)\\\\n\\\\tmxt6(sample_lineage)\\\\n\\\\t1Tdy(sample_partition_table)\\\\n\\\\tP5GH(sample_sharding_*)\\\\n\\\\tFHJh(sample_snapshot_table)\\\\n\\\\tsldk(stations_scd_type2)\\\\nend\\\\nsubgraph bigquery-public-data.austin_bikeshare\\\\n\\\\t0Q1b(bikeshare_stations)\\\\nend\\\\n5BLN --> H1NS\\\\noEk9 --> H1NS\\\\n5BLN --> oEk9\\\\n5BLN --> FHJh\\\\noEk9 --> FHJh\\\\n0Q1b --> sldk\\\\n\`\`\`\\\\n<!--- BQMAKE_DATASET: END -->\\",
  location=\\"us\\"
)
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.mymodel from examples/@default/sandbox/@models/mymodel/ddl.sql
CREATE MODEL IF NOT EXISTS \`sandbox.mymodel\`
OPTIONS
  ( MODEL_TYPE='LINEAR_REG',
    LS_INIT_LEARN_RATE=0.15,
    L1_REG=1,
    MAX_ITERATIONS=5 ) AS
SELECT
  c1 as column1,
  c1 * 2 as column2,
  c1 * 3 as column3,
  c1 * 10 as label
FROM
  unnest(generate_array(1, 10)) c1

exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_function from examples/@default/sandbox/@routines/sample_function/ddl.sql
CREATE OR REPLACE FUNCTION \`sandbox.sample_function\`(argument INT64) RETURNS INT64
OPTIONS(
  description=\\"test\\")
AS (
1
)
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_procedure from examples/@default/sandbox/@routines/sample_procedure/ddl.sql
CREATE OR REPLACE PROCEDURE \`sandbox.sample_procedure\`(IN sample_argument INT64)
begin 
  select 1 as a;
end
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_tvf from examples/@default/sandbox/@routines/sample_tvf/ddl.sql
CREATE OR REPLACE TABLE FUNCTION \`sandbox.sample_tvf\`(argument INT64) RETURNS TABLE<a INT64>
AS
select argument as a
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.error_sample from examples/@default/sandbox/error_sample/ddl.sql

exception when error then
end

begin
-- BQPORTER: takegue.sandbox.error_sample from examples/@default/sandbox/error_sample/test.sql

select error('error message')
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.error_sample from examples/@default/sandbox/error_sample/view.sql

hoge

exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_clone_table from examples/@default/sandbox/sample_clone_table/ddl.sql
CREATE TABLE IF NOT EXISTS \`sandbox.sample_clone_table\`
(
  a INT64
)
CLUSTER BY a
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_partition_table from examples/@default/sandbox/sample_partition_table/ddl.sql
CREATE TABLE IF NOT EXISTS \`sandbox.sample_partition_table\`
(
  date_jst DATE
)
PARTITION BY date_jst
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_sharding_* from examples/@default/sandbox/sample_sharding_@/ddl.sql
CREATE TABLE IF NOT EXISTS \`takegue.sandbox.sample_sharding_20220101\`
(
  date_jst DATE
)
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_snapshot_table from examples/@default/sandbox/sample_snapshot_table/ddl.sql
CREATE SNAPSHOT TABLE \`sandbox.sample_snapshot_table\`
CLONE \`takegue.sandbox.sample_table\`
FOR SYSTEM_TIME AS OF TIMESTAMP \\"2023-01-01T01:12:07.322Z\\"
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_table from examples/@default/sandbox/sample_table/ddl.sql
CREATE TABLE IF NOT EXISTS \`sandbox.sample_table\`
(
  a INT64 OPTIONS(description=\\"ふがふが
ふが\\")
)
CLUSTER BY a
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_view from examples/@default/sandbox/sample_view/view.sql
SELECT * FROM \`bigquery-public-data.austin_311.311_service_requests\` LIMIT 1000

exception when error then
end

begin
-- BQPORTER: takegue.sandbox from examples/@default/sandbox/@_queries/preview.sql
select * from \`sandbox.sample_table\`

exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_materialized_view from examples/@default/sandbox/sample_materialized_view/ddl.sql
CREATE MATERIALIZED VIEW IF NOT EXISTS  \`sandbox.sample_materialized_view\`
AS select 1 as a from \`sandbox.sample_table\`
exception when error then
end

begin
-- BQPORTER: takegue.sandbox.sample_table from examples/@default/sandbox/sample_table/preview.sql
select * from \`sandbox.sample_table\`

exception when error then
end",
]
`;

exports[`CLI: bundle > bundle -C ./examples 2`] = `
[
  "Warning: Irrelevant SQL file located in examples/@default/sandbox/error_sample/ddl.sql for takegue.sandbox.error_sample",
  "Warning: Irrelevant SQL file located in examples/@default/sandbox/error_sample/test.sql for takegue.sandbox.error_sample",
]
`;
